THREE.TrackballControls=function(t,e,o){function n(t){h.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),g===p.NONE&&(g=t.button),g!==p.ROTATE||h.noRotate?g!==p.ZOOM||h.noZoom?g!==p.PAN||h.noPan||(R=y=h.getMouseOnScreen(t.clientX,t.clientY)):b=O=h.getMouseOnScreen(t.clientX,t.clientY):E=f=h.getMouseProjectionOnBall(t.clientX,t.clientY),h.domElement.addEventListener("mousemove",a,!1),h.addEventListener("mouseup",i,!1))}function a(t){h.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),g!==p.ROTATE||h.noRotate?g!==p.ZOOM||h.noZoom?g!==p.PAN||h.noPan||(y=h.getMouseOnScreen(t.clientX,t.clientY)):O=h.getMouseOnScreen(t.clientX,t.clientY):f=h.getMouseProjectionOnBall(t.clientX,t.clientY))}function i(t){h.enabled!==!1&&(t.preventDefault(),t.stopPropagation(),g=p.NONE,h.domElement.removeEventListener("mousemove",a),h.removeEventListener("mouseup",i))}function s(t){if(h.enabled!==!1){t.preventDefault(),t.stopPropagation();var e=0;t.wheelDelta?e=t.wheelDelta/40:t.detail&&(e=-t.detail/3),b.y+=.01*e}}function c(t){if(h.enabled!==!1)switch(t.touches.length){case 1:g=p.TOUCH_ROTATE,E=f=h.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:g=p.TOUCH_ZOOM;var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY;T=v=Math.sqrt(e*e+o*o);break;case 3:g=p.TOUCH_PAN,R=y=h.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY);break;default:g=p.NONE}}function r(t){if(h.enabled!==!1)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:f=h.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:var e=t.touches[0].pageX-t.touches[1].pageX,o=t.touches[0].pageY-t.touches[1].pageY;T=Math.sqrt(e*e+o*o);break;case 3:y=h.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY);break;default:g=p.NONE}}function u(t){if(h.enabled!==!1){switch(t.touches.length){case 1:E=f=h.getMouseProjectionOnBall(t.touches[0].pageX,t.touches[0].pageY);break;case 2:v=T=0;break;case 3:R=y=h.getMouseOnScreen(t.touches[0].pageX,t.touches[0].pageY)}g=p.NONE}}this.lights=o||[];var h=this,p={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={width:0,height:0,offsetLeft:0,offsetTop:0},this.radius=(this.screen.width+this.screen.height)/4,this.rotateSpeed=2.6,this.zoomSpeed=1.2,this.panSpeed=1,this.autoRotate=!1,this.isControls=!0;Date.now();this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var l=new THREE.Vector3,g=p.NONE,d=p.NONE,m=new THREE.Vector3,E=new THREE.Vector3,f=new THREE.Vector3,b=new THREE.Vector2,O=new THREE.Vector2,v=0,T=0,R=new THREE.Vector2,y=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var j={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth,this.screen.height=window.innerHeight,this.screen.offsetLeft=0,this.screen.offsetTop=0,this.radius=(this.screen.width+this.screen.height)/4},this.handleEvent=function(t){"function"==typeof this[t.type]&&this[t.type](t)},this.getMouseOnScreen=function(t,e){return new THREE.Vector2((t-h.screen.offsetLeft)/h.radius*.5,(e-h.screen.offsetTop)/h.radius*.5)},this.getMouseProjectionOnBall=function(t,e){var o=new THREE.Vector3((t-.5*h.screen.width-h.screen.offsetLeft)/h.radius,(.5*h.screen.height+h.screen.offsetTop-e)/h.radius,0),n=o.length();n>1?o.normalize():o.z=Math.sqrt(1-n*n),m.copy(h.object.position).sub(h.target);var a=h.object.up.clone().setLength(o.y);return a.add(h.object.up.clone().cross(m).setLength(o.x)),a.add(m.setLength(o.z)),a},this.rotateCamera=function(){var t=Math.acos(E.dot(f)/E.length()/f.length());if(t){var e=(new THREE.Vector3).crossVectors(E,f).normalize();quaternion=new THREE.Quaternion,t*=h.rotateSpeed,quaternion.setFromAxisAngle(e,-t),m.applyQuaternion(quaternion),h.object.up.applyQuaternion(quaternion);for(var o=0;o<h.lights.length;o++)h.lights[o].position.applyQuaternion(quaternion);f.applyQuaternion(quaternion),h.staticMoving?E.copy(f):(quaternion.setFromAxisAngle(e,t*(h.dynamicDampingFactor-1)),E.applyQuaternion(quaternion))}},this.toggleAutoRotate=function(){arguments.length?this.autoRotate=arguments[0]:h.autoRotate=!h.autoRotate,h.autoRotate?this.autoRotateOn():this.autoRotateOff()},this.autoRotateOn=function(){h.time=Date.now(),h.autoRotate=!0},this.autoRotateOff=function(){h.autoRotate=!1},this.autoRotateCamera=function(){var t=Date.now(),e=0;if(h.time&&(e=25e-5*(t-h.time)*.5*Math.PI),h.time=t,e&&g!=p.ROTATE&&g!=p.TOUCH_ROTATE){var o=new THREE.Vector3(0,1,0);quaternion=new THREE.Quaternion,e*=h.rotateSpeed,quaternion.setFromAxisAngle(o,-e),h.object.position.applyQuaternion(quaternion);for(var n=0;n<h.lights.length;n++)h.lights[n].position.applyQuaternion(quaternion)}},this.zoomCamera=function(){if(g===p.TOUCH_ZOOM){var t=v/T;v=T,m.multiplyScalar(t)}else{var t=1+(O.y-b.y)*h.zoomSpeed;1!==t&&t>0&&(m.multiplyScalar(t),h.staticMoving?b.copy(O):b.y+=(O.y-b.y)*this.dynamicDampingFactor)}},this.panCamera=function(t,e){t||(t=h.panSpeed),e||(e=h.staticMoving);var o=y.clone().sub(R);if(o.lengthSq()){o.multiplyScalar(m.length()*t);var n=m.clone().cross(h.object.up).setLength(o.x);n.add(h.object.up.clone().setLength(o.y)),h.object.position.add(n),h.target.add(n),e?R=y:R.add(o.subVectors(y,R).multiplyScalar(h.dynamicDampingFactor))}},this.checkDistances=function(){h.noZoom&&h.noPan||(h.object.position.lengthSq()>h.maxDistance*h.maxDistance&&h.object.position.setLength(h.maxDistance),m.lengthSq()<h.minDistance*h.minDistance&&h.object.position.addVectors(h.target,m.setLength(h.minDistance)))},this.update=function(){h.autoRotate&&this.autoRotateCamera(),h.isControls&&(m.subVectors(h.object.position,h.target),h.noRotate||h.rotateCamera(),h.noZoom||h.zoomCamera(),h.noPan||h.panCamera(),h.object.position.addVectors(h.target,m),h.checkDistances(),h.object.lookAt(h.target),l.distanceToSquared(h.object.position)>0&&(h.dispatchEvent(j),l.copy(h.object.position)))},this.reset=function(){g=p.NONE,d=p.NONE,h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.up.copy(h.up0),m.subVectors(h.object.position,h.target),h.object.lookAt(h.target),h.dispatchEvent(j),l.copy(h.object.position)},this.domElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mouseup",i,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",c,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",r,!1),this.handleResize(),this.object.__linRotate=function(t,e,o){e=e*Math.PI/180,o||(h.target.copy(h.target0),h.object.position.copy(h.position0),h.object.up.copy(h.up0),m.subVectors(h.object.position,h.target),h.object.lookAt(h.target),h.dispatchEvent(j),l.copy(h.object.position)),quaternion=new THREE.Quaternion,quaternion.setFromAxisAngle(t,-e),m.applyQuaternion(quaternion),h.object.up.applyQuaternion(quaternion),h.object.position.addVectors(h.target,m),h.checkDistances(),h.object.lookAt(h.target),l.distanceToSquared(h.object.position)>0&&(h.dispatchEvent(j),l.copy(h.object.position))},this.object.__linZoom=function(t){b.y+=.01*t},this.object.__linPan=function(t,e){t/=1e3,e/=1e3,R=h.getMouseOnScreen(0,0),y=h.getMouseOnScreen(0,0),y.x+=t,y.y+=e,h.panCamera(1,1)}},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);